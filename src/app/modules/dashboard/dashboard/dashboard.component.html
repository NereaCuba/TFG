<div class="d-flex justify-content-center flex-column align-items-center mt-4"  *ngIf="loading">
    <div class="spinner-border mt-4 mb-4" role="status">
    </div>
    <h5 class="text-center mt-4 loadingFont">Cargando...</h5>
</div>
<div *ngIf="loaded">
    <div class="backColor" *ngIf="authService.userInfo as user">
        <div class="container dashBoard">
            <div class="card" data-aos="fade-up" data-aos-duration="2000">
                <div class="container">
                    <div class="row">
                        <div class="col-12 ml-sm-auto p-4">
                            <div class="inner-adjust">
                                <div class="row" *ngIf="authService.userData as user">
                                    <div class="col-12 col-lg-4 col-xl-2 p-4">
                                        <div class="media mt-2">
                                            <div class="justify-content-center align-items-center headerCard">
                                                <img class="img-thumbnail rounded-circle mb-4" src="{{(user.photoURL) ? user.photoURL : './assets/avatar-default-icon.png'}}"
                                                alt="{{user.displayName}}">
                                                <h4 class="mb-2 text-lg-start text-center" *ngIf="user.displayName">{{(user.displayName) ? user.displayName : 'User'}}</h4>
                                                <p class="d-lg-flex align-items-center justify-lg-content-center text-lg-start text-center"><i class="pi pi-envelope me-2"></i> {{user.email}} </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-4 col-lg-4  text-center col-12 d-flex flex-column align-items-center justify-content-center pt-6" *ngIf="authService.userInfo as user">
                                        <h6 class="mt-5">Número de gráficos totales analizados</h6>
                                        <p>{{user.charts  && user.charts.length ? user.charts.length : '0'}}</p>
                                    </div>
                                    <div class="col-xl-4 col-lg-4  text-center col-12 d-flex flex-column align-items-center justify-content-center pt-6" *ngIf="authService.userInfo as user">
                                        <h6 class="mt-5">Gráficos con una puntuación superior a 8</h6>
                                        <p>{{numAproved ? numAproved : '0'}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container dashBoard2" *ngIf="user.charts && user.charts.length !== 0">
            <div class="card" data-aos="fade-up" data-aos-duration="2000">
                <div class="container p-4">
                    <p-dataView #dv [value]="user.charts" [rows]="3" [paginator]="true" [sortField]="sortField" [sortOrder]="sortOrder">
                        <ng-template pTemplate="header">
                            <div class="d-flex justify-content-between">
                                <div class="flex flex-column lg:flex-row lg:justify-content-between">
                                    <p-dropdown [options]="sortOptions" placeholder="Ordenar por fecha" (onChange)="onSortChange($event)" styleClass="mb-2 lg:mb-0"></p-dropdown>
                                </div>
                            </div>
                        </ng-template>
                        <ng-template let-product let-index="rowIndex"  pTemplate="listItem">
                            <div class="col-12 hoveredCursor" (click)="evaluateShow(index)">
                                <div class="row p-4">
                                    <div class="col-12 col-lg-4" *ngIf="!product.isIframe">
                                        <img class="w-100" src="{{product.image}}" alt="Imagen del gráfico" />
                                    </div>
                                    <div class="col-12 w-100 h-100 overflow-scroll" *ngIf="product.isIframe">
                                        <iframe [src]="product.image | safe " style="width: 100%; height: 50em; border: 0px none; overflow: scroll;"></iframe>
                                    </div>
                                        <div class="col-12" [ngClass]="product.isIframe ? '' : 'col-lg-8'">
                                        <div class="d-flex flex-column justify-content-between align-items-between h-100">
                                            <div class="flex flex-column align-items-center ">
                                                <h4>Gráfico {{index + 1}}</h4>
                                                <div class="">
                                                    <span class="flex align-items-center gap-2">
                                                        <i class="pi pi-calendar"></i>
                                                        <span class="ms-2 font-semibold">{{getCurrentDate(product.fechaCreacion)}}</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="col-lg-5 mt-4 col d-flex justify-content-center align-items-center d-none d-lg-block">
                                                <p [ngClass]="'Score' + getScoreInt(getPunctuation(product.formValue))">{{constLinkertBrief[getScore(getPunctuation(product.formValue))]}}</p>
                                            </div>
                                            <div class="d-flex mt-4 justify-content-between">
                                                <h6>PUNTUACIÓN TOTAL: {{getPunctuation(product.formValue)}}</h6>
                                                <div class="d-flex">
                                                    <button pButton icon="pi pi-download" (click)="downloadResults(product.formValue)" class="lg:align-self-end mb-2 p-button-rounded"></button>
                                                    <button pButton icon="pi pi-eye" (click)="evaluateShow(sortOrder == -1 ? 5-index : index)" class="ms-4 lg:align-self-end mb-2 p-button-rounded"></button>
                                                    <button pButton icon="pi pi-trash" (click)="deleteElement(user.email, product)" class="ms-4 lg:align-self-end mb-2 p-button-rounded p-button-danger"></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </ng-template>
                    </p-dataView>
                </div>
            </div>
        </div>
    </div>
</div>
